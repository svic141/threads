{% extends 'core/base.html' %}

{% block title %} {{ title }} {% endblock %}

{% block content %}

    <div class="w-full mb-6 grid grid-cols-2 grid-rows-1 gap-4 align-center">
        <div>
            <form method="get" action="{% url 'item:browse' %}" class="w-full mb-6 grid grid-cols-2 grid-rows-1 gap-4">
                <input name ="query" class="w-full py-2 px-6 border rounded-xl focus:bg-gray-10 focus:border-teal-300" type="text"  value ="{{ query }}" placeholder="Search">
                <button class="w-1/4mt-2 py-2 px-6 text-lg bg-teal-500 text-white rounded-xl hover:bg-teal-700">Search</button>
            </form>
        </div>

        <div x-data="{ open: false }" class="relative inline-block text-left">
            <button @click="open = !open" type="button" class="inline-flex w-full justify-center gap-x-1.5 rounded-md  border-b py-2 text-sm font-semibold text-grey-700 border border-white/20 hover:bg-white/20">
                Filter By:
                <svg viewBox="0 0 20 20" fill="currentColor" class="-mr-1 size-5 text-gray-400">
                <path d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z" />
                </svg>
            </button>

            <form x-show="open" @click.away="open = false" method="get" action="{% url 'item:browse' %}" 
                        class="absolute right-0 mt-2 w-64 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 focus:outline-none z-10 p-4 transition duration-200 ease-out"
                        x-transition:enter="transition ease-out duration-100"
                        x-transition:enter-start="transform opacity-0 scale-95"
                        x-transition:enter-end="transform opacity-100 scale-100"
                        x-transition:leave="transition ease-in duration-75"
                        x-transition:leave-start="transform opacity-100 scale-100"
                        x-transition:leave-end="transform opacity-0 scale-95"
            >
                <input type="hidden" name="query" value="{{ query }}">
                    
                <div class="space-y-2 max-h-60 overflow-y-auto">
                    {% for category in categories %}
                        <label class="flex items-center space-x-2">
                        <input 
                            type="checkbox" 
                            name="category" 
                            value="{{ category.id }}" 
                            {% if category.id in selected_categories %}checked{% endif %}
                            class="form-checkbox h-4 w-4 text-teal-600">
                        <span>{{ category.name }}</span>
                        </label>
                    {% endfor %}
                </div>

                  {% if query or selected_categories %}
                <a href="{% url 'item:browse' %}" 
                    class="mt-2 w-full py-2 px-4 text-center bg-red-100 text-red-700 rounded hover:bg-red-200 block">
                    Clear All Filters
                </a>
                {% endif %}

                <button type="submit" class="mt-4 w-full py-2 px-4 bg-teal-500 text-white rounded hover:bg-teal-700">
                    Apply Filters
                </button>

            </form>
        </div>
    </div> 

    <div class="grid grid-cols-4 gap-3">
        {% for item in items %}
            <div>
                <a href="{% url 'item:detail' item.id %}">
                    <div class="grid grid-cols-5 grid-rows-5 gap-4">
                            <div class="col-span-3 row-span-5">
                                {% if item.item_image.url != NULL %}                        
                                    <img src = "{{ item.item_image.url }}" class="rounded-t-lx hover:scale-120">
                                {% else %}
                                    <div class = "p-6 bg-gray-300 rounded-b-xl"></div>
                                {%endif%}
                            </div>
                            <div class="col-span-2 row-span-3 col-start-4">
                                {% if item.item_image2.url != NULL %}                        
                                    <img src = "{{ item.item_image2.url }}" class="rounded-t-lx hover:scale-120">
                                {% else %}
                                    <div class = "p-6 bg-gray-30 rounded-b-xl"></div>
                                {%endif%}                        </div>
                            <div class="col-span-2 row-span-2 col-start-4 row-start-4">
                                {% if item.item_image3.url != NULL %}                        
                                    <img src = "{{ item.item_image3.url }}" class="rounded-t-lx hover:scale-120">
                                {% else %}
                                    <div class = "p-6 bg-gray-300 rounded-b-xl"></div>
                                {%endif%}                        
                            </div>
                    </div>

                    <div class = "p-6 bg-gray-50 rounded-b-xl">
                        <h2 class="text-xl">{{ item.name }}</h2>
                        <p class="text-sm text-gray-500">R{{item.price}}</p>
                    </div>
                </a>
            </div>
        {% endfor %}
    </div>

{% endblock %}